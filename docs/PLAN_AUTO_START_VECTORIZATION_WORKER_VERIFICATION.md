# Plan Verification: Auto-start Vectorization Worker for New Projects

**Author**: Vasiliy Zdanovskiy  
**email**: vasilyvz@gmail.com  
**Date**: 2026-01-09  
**Verification Date**: 2026-01-09

## Executive Summary

**–í–ê–ñ–ù–û**: –ü–æ —É—Ç–æ—á–Ω–µ–Ω–∏—é —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π:
- **–î–∞—Ç–∞—Å–µ—Ç—ã –ü–û–õ–ù–û–°–¢–¨–Æ –∏—Å–∫–ª—é—á–µ–Ω—ã** - —Ä–∞–±–æ—Ç–∞ –¢–û–õ–¨–ö–û –ø–æ–ø—Ä–æ–µ–∫—Ç–Ω–æ
- **FAISS –∏–Ω–¥–µ–∫—Å**: `{faiss_dir}/{project_id}.bin` (project-scoped, –ù–ï dataset-scoped)
- **MCP Command `start_worker`**: —Ç–æ–ª—å–∫–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º

–ü–ª–∞–Ω **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π** –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º. Step 0 –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ project-scoped –∏–Ω–¥–µ–∫—Å—ã –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤.

## ‚úÖ –ß—Ç–æ —É—á—Ç–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

1. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `project_id` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–æ—Ä–∫–µ—Ä–∞
2. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `watch_dirs` –≤ –≤–æ—Ä–∫–µ—Ä–µ
3. ‚úÖ –†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã)
4. ‚úÖ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
5. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
6. ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å file watcher –∏ vectorization worker
7. ‚úÖ PID file check –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–æ–≤
8. ‚úÖ Database auto-creation –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ë–î
9. ‚úÖ FAISS index sync check –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–æ—Ä–∫–µ—Ä–∞
10. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ MCP –∫–æ–º–∞–Ω–¥—ã `start_worker`
11. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ worker registration –≤ WorkerManager

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è

### 1. **–ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã FAISS –∏–Ω–¥–µ–∫—Å–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- **Step 0** –ø–ª–∞–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ **project-scoped –∏–Ω–¥–µ–∫—Å—ã**: `{faiss_dir}/{project_id}.bin`
- **–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **dataset-scoped –∏–Ω–¥–µ–∫—Å—ã**: `{faiss_dir}/{project_id}/{dataset_id}.bin`
- –ú–µ—Ç–æ–¥ `get_faiss_index_path(faiss_dir, project_id, dataset_id)` —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ dataset

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
# code_analysis/core/storage_paths.py
def get_faiss_index_path(faiss_dir: Path, project_id: str, dataset_id: str) -> Path:
    index_file = faiss_dir / project_id / f"{dataset_id}.bin"
    return index_file
```

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 0: "FAISS index path: `{faiss_dir}/{project_id}.bin` (project-scoped, not dataset-scoped)"
- Step 3: "FAISS manager is created dynamically for each project"
- Step 5: "Rebuild FAISS indexes for all projects" (–æ–¥–∏–Ω –∏–Ω–¥–µ–∫—Å –Ω–∞ –ø—Ä–æ–µ–∫—Ç)

**–†–µ—à–µ–Ω–∏–µ**: 
**–í–ê–†–ò–ê–ù–¢ A (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å dataset-scoped –∏–Ω–¥–µ–∫—Å—ã
- Worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–≤–æ–π FAISS manager
- –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–ª–∞–Ω–µ**:
  - Step 0: –£–î–ê–õ–ò–¢–¨ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å - –ù–ï —É–¥–∞–ª—è—Ç—å dataset_id, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å dataset-scoped –∏–Ω–¥–µ–∫—Å—ã
  - Step 3: –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ "FAISS Manager per Dataset" - —Å–æ–∑–¥–∞–≤–∞—Ç—å manager –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
  - Step 5: –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ (–Ω–µ –æ–¥–∏–Ω –Ω–∞ –ø—Ä–æ–µ–∫—Ç)
  - –£—Ç–æ—á–Ω–∏—Ç—å, —á—Ç–æ worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ

**–í–ê–†–ò–ê–ù–¢ B**: –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ project-scoped –∏–Ω–¥–µ–∫—Å—ã (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
- –û–¥–∏–Ω FAISS –∏–Ω–¥–µ–∫—Å –¥–ª—è –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ
- –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ `get_faiss_index_path()` –∏ –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö dataset-scoped –∏–Ω–¥–µ–∫—Å–æ–≤
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–ª–∞–Ω–µ**:
  - –î–æ–±–∞–≤–∏—Ç—å —à–∞–≥ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
  - –ò–∑–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è dataset-scoped –ø—É—Ç—å –∫ –∏–Ω–¥–µ–∫—Å—É

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—Ä–∏–∞–Ω—Ç A (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å dataset-scoped), —Ç–∞–∫ –∫–∞–∫:
- –ú–µ–Ω—å—à–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –ò–∑–±–µ–≥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
- Dataset-scoped –∏–Ω–¥–µ–∫—Å—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ª—É—á—à—É—é —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞

### 2. **–ö–†–ò–¢–ò–ß–ù–û: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –Ω–µ —É—á—Ç–µ–Ω–∞**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–ª–∞–Ω –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **–≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ**.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ö–∞–∂–¥—ã–π –ø—Ä–æ–µ–∫—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- –ú–µ—Ç–æ–¥ `database.get_project_datasets(project_id)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
- –ú–µ—Ç–æ–¥—ã `get_files_needing_chunking(project_id)` –∏ `get_non_vectorized_chunks(project_id, dataset_id=None)` —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞
- –í `main.py` worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 2: "For each project in sorted list" - –Ω–æ –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- Step 1: `get_projects_with_vectorization_count()` - –Ω–µ —è—Å–Ω–æ, —É—á–∏—Ç—ã–≤–∞–µ—Ç –ª–∏ –¥–∞—Ç–∞—Å–µ—Ç—ã
- Step 2: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `get_non_vectorized_chunks(project_id, dataset_id=None)` - —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã, –Ω–æ –Ω–µ —Å–æ–∑–¥–∞—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ FAISS managers

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–∞–Ω:

**Step 1 (—É—Ç–æ—á–Ω–µ–Ω–∏–µ)**:
- –ú–µ—Ç–æ–¥ `get_projects_with_vectorization_count()` –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö
- –ü–æ–¥—Å—á–µ—Ç: —Å—É–º–º–∞ –ø–æ –≤—Å–µ–º –¥–∞—Ç–∞—Å–µ—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞ (—Ñ–∞–π–ª—ã + —á–∞–Ω–∫–∏)
- SQL –∑–∞–ø—Ä–æ—Å —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã —á–µ—Ä–µ–∑ `WHERE f.project_id = p.id`)

**Step 2 (—É—Ç–æ—á–Ω–µ–Ω–∏–µ)**:
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã: `database.get_project_datasets(project_id)`
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞:
  - –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª—ã –¥–ª—è —á–∞–Ω–∫–∏–Ω–≥–∞: `database.get_files_needing_chunking(project_id)` (—É–∂–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞, –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã)
  - –ü–æ–ª—É—á–∏—Ç—å —á–∞–Ω–∫–∏ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: `database.get_non_vectorized_chunks(project_id, dataset_id=dataset_id)` (–¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞)
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª—ã –∏ —á–∞–Ω–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π FAISS manager –¥–ª—è —ç—Ç–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ (—Å–æ–∑–¥–∞—Ç—å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `index_path`)

### 3. **–ú–µ—Ç–æ–¥ get_projects_with_vectorization_count() - SQL –∑–∞–ø—Ä–æ—Å**

**–ü—Ä–æ–±–ª–µ–º–∞**: SQL –∑–∞–ø—Ä–æ—Å –≤ Step 1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –¥–µ—Ç–∞–ª–∏.

**–¢–µ–∫—É—â–∏–π SQL –≤ –ø–ª–∞–Ω–µ**:
```sql
-- Count chunks needing vectorization (all datasets in project)
(SELECT COUNT(cc.id)
 FROM code_chunks cc
 INNER JOIN files f ON cc.file_id = f.id
 WHERE cc.project_id = p.id
   AND (f.deleted = 0 OR f.deleted IS NULL)
   AND cc.embedding_vector IS NOT NULL
   AND cc.vector_id IS NULL)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: SQL –∑–∞–ø—Ä–æ—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π - —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã —á–µ—Ä–µ–∑ `WHERE cc.project_id = p.id` –∏ `INNER JOIN files f`, —á—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û—Å—Ç–∞–≤–∏—Ç—å SQL –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, —á—Ç–æ –æ–Ω —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞.

### 4. **Worker registration –≤ WorkerManager**

**–ü—Ä–æ–±–ª–µ–º–∞**: –í –ø–ª–∞–Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –≤–æ—Ä–∫–µ—Ä–∞, –Ω–æ –Ω–µ –≤—Å–µ –¥–µ—Ç–∞–ª–∏ —É—á—Ç–µ–Ω—ã.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –í `main.py`: `f"vectorization_{project_id}"` –∏–ª–∏ `f"vectorization_{project_id}_{dataset_id[:8]}"`
- –í `worker_launcher.py`: `f"vectorization_{project_id}"`

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 6: "Change worker name from `f"vectorization_{project_id}"` to `"vectorization_universal"`"
- Step 6: "Update worker registration in `WorkerManager`"

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: ‚úÖ –£—á—Ç–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å:
- –ò–º—è –≤–æ—Ä–∫–µ—Ä–∞: `"vectorization_universal"` (–æ–¥–Ω–æ –¥–ª—è –≤—Å–µ—Ö)
- –û–±–Ω–æ–≤–∏—Ç—å restart function (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞

### 5. **FAISS index path –≤ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å dataset-scoped –∏–Ω–¥–µ–∫—Å—ã, –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø—É—Ç—å –∫ –∏–Ω–¥–µ–∫—Å—É –≤ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–º –≤–æ—Ä–∫–µ—Ä–µ.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- `run_vectorization_worker()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `faiss_index_path` –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
- –í —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–Ω–æ–≥–æ –ø—É—Ç–∏

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 3: "Pass `faiss_dir` (base directory) instead of `faiss_index_path` to worker"
- Step 3: "Worker creates FAISS manager for each project as needed"

**–†–µ—à–µ–Ω–∏–µ**: 
- **–ï—Å–ª–∏ dataset-scoped**: –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `faiss_dir` –≤–º–µ—Å—Ç–æ `faiss_index_path`, —Å–æ–∑–¥–∞–≤–∞—Ç—å FAISS manager –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ —Å –ø—É—Ç–µ–º: `get_faiss_index_path(faiss_dir, project_id, dataset_id)`
- **–ï—Å–ª–∏ project-scoped**: –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `faiss_dir`, —Å–æ–∑–¥–∞–≤–∞—Ç—å manager —Å –ø—É—Ç–µ–º: `faiss_dir / f"{project_id}.bin"`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –£—Ç–æ—á–Ω–∏—Ç—å –≤ Step 3, —á—Ç–æ –¥–ª—è dataset-scoped –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å manager –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

### 6. **–ú–µ—Ç–æ–¥ get_non_vectorized_chunks() —Ç—Ä–µ–±—É–µ—Ç dataset_id**

**–ü—Ä–æ–±–ª–µ–º–∞**: –í Step 2 —É–∫–∞–∑–∞–Ω–æ `database.get_non_vectorized_chunks(project_id, dataset_id=None)`, –Ω–æ –¥–ª—è dataset-scoped –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- `get_non_vectorized_chunks(project_id, dataset_id=None)` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞–Ω–∫–∏ –¥–ª—è –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
- `get_non_vectorized_chunks(project_id, dataset_id=dataset_id)` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞–Ω–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 2: "Get chunks needing vectorization: `database.get_non_vectorized_chunks(project_id, dataset_id=None)` (all datasets in project)"

**–†–µ—à–µ–Ω–∏–µ**: –£—Ç–æ—á–Ω–∏—Ç—å –≤ Step 2:
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞: `database.get_non_vectorized_chunks(project_id, dataset_id=dataset_id)`
- –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å dataset-scoped FAISS –∏–Ω–¥–µ–∫—Å–∞–º–∏

### 7. **–ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ FAISS –∏–Ω–¥–µ–∫—Å–∞**

**–ü—Ä–æ–±–ª–µ–º–∞**: Step 5 –≥–æ–≤–æ—Ä–∏—Ç –æ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç—ã.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- `rebuild_from_database()` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `project_id` –∏ `dataset_id`
- –í `main.py` –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 5: "After processing all projects in a cycle, rebuild FAISS indexes for all projects"
- Step 5: "For each project: rebuild index from database for this project"

**–†–µ—à–µ–Ω–∏–µ**: –£—Ç–æ—á–Ω–∏—Ç—å –≤ Step 5:
- –ï—Å–ª–∏ dataset-scoped: –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—É—é –∑–∞–º–µ–Ω—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–¥–µ–∫—Å —Ñ–∞–π–ª–∞
- –ò–ª–∏ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

### 8. **FAISS index sync check –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**

**–ü—Ä–æ–±–ª–µ–º–∞**: Step 4 —É–ø–æ–º–∏–Ω–∞–µ—Ç sync check –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç—ã.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- `check_index_sync(database, project_id=project_id, dataset_id=dataset_id)` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –¥–∞—Ç–∞—Å–µ—Ç–æ–º
- –í `runner.py` sync check –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è –æ–¥–Ω–æ–≥–æ project_id –∏ dataset_id

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 4: "For universal worker, check sync for all projects at startup"
- Step 4: "For each project: check sync: `faiss_manager.check_index_sync(database, project_id=project_id, dataset_id=None)`"

**–†–µ—à–µ–Ω–∏–µ**: –£—Ç–æ—á–Ω–∏—Ç—å –≤ Step 4:
- –ï—Å–ª–∏ dataset-scoped: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å sync –æ—Ç–¥–µ–ª—å–Ω–æ
- –°–æ–∑–¥–∞—Ç—å FAISS manager –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å sync, –∑–∞–∫—Ä—ã—Ç—å manager

### 9. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ get_project_datasets()**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–ª–∞–Ω –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç –º–µ—Ç–æ–¥ `database.get_project_datasets(project_id)`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –≤ Step 2 –∏ Step 4 —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ `database.get_project_datasets(project_id)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞.

### 10. **PID file –ø—É—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–ª–∞–Ω —É–ø–æ–º–∏–Ω–∞–µ—Ç PID file, –Ω–æ –Ω–µ –≤—Å–µ –¥–µ—Ç–∞–ª–∏ —É—á—Ç–µ–Ω—ã.

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 6: "Define PID file path: `logs/vectorization_worker.pid` (or from config)"
- Step 6: "Write PID file after worker starts"

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: ‚úÖ –£—á—Ç–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å:
- PID file –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ (–Ω–µ per-project –∏–ª–∏ per-dataset)
- –ü—É—Ç—å: `logs/vectorization_worker.pid` (–±–µ–∑ project_id/dataset_id)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ stale PID file (—É–¥–∞–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –º–µ—Ä—Ç–≤)

### 11. **Database auto-creation –¥–µ—Ç–∞–ª–∏**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–ª–∞–Ω —É–ø–æ–º–∏–Ω–∞–µ—Ç database auto-creation, –Ω–æ –Ω–µ –≤—Å–µ –¥–µ—Ç–∞–ª–∏ —É—á—Ç–µ–Ω—ã.

**–ß—Ç–æ –≤ –ø–ª–∞–Ω–µ**:
- Step 4: "Database auto-creation (required): Before connecting to database, check if database file exists"
- Step 6: "Database auto-creation (before starting worker): Check if database file exists"

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: ‚úÖ –£—á—Ç–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å:
- –î–ª—è test database: –≤—Å–µ–≥–¥–∞ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—É—é –ë–î –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é
- –î–ª—è production: –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ–∑–¥–∞–Ω–∏—è –ë–î

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø–ª–∞–Ω–∞

### 1. **–ö–†–ò–¢–ò–ß–ù–û: –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "Architecture Decision: FAISS Index Strategy"**

–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ç–∫–æ:
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å dataset-scoped –∏–Ω–¥–µ–∫—Å—ã –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ project-scoped
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞
- –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –º–µ–Ω—è–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å dataset-scoped –∏–Ω–¥–µ–∫—Å—ã (–í–∞—Ä–∏–∞–Ω—Ç A).

### 2. **–ö–†–ò–¢–ò–ß–ù–û: –£—Ç–æ—á–Ω–∏—Ç—å Step 0**

–ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –í–∞—Ä–∏–∞–Ω—Ç A (dataset-scoped):
- **–£–î–ê–õ–ò–¢–¨ Step 0** –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ –Ω–∞:
  - "Keep dataset-scoped FAISS indexes"
  - "Worker will process all datasets in each project"
  - "FAISS index path remains: `{faiss_dir}/{project_id}/{dataset_id}.bin`"
  - "Worker creates FAISS manager dynamically for each dataset"

### 3. **–ö–†–ò–¢–ò–ß–ù–û: –£—Ç–æ—á–Ω–∏—Ç—å Step 2**

–î–æ–±–∞–≤–∏—Ç—å:
- –û–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤: `database.get_project_datasets(project_id)`
- –û–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ FAISS manager –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**:
```python
for project in projects_with_count:
    project_id = project['project_id']
    datasets = database.get_project_datasets(project_id)
    
    for dataset in datasets:
        dataset_id = dataset['id']
        # Get files needing chunking (project-level, handles all datasets)
        files_to_chunk = database.get_files_needing_chunking(project_id)
        # Process files...
        
        # Get chunks for this specific dataset
        chunks_to_vectorize = database.get_non_vectorized_chunks(
            project_id, dataset_id=dataset_id
        )
        
        # Create FAISS manager for this dataset
        index_path = get_faiss_index_path(faiss_dir, project_id, dataset_id)
        faiss_manager = FaissIndexManager(index_path=index_path, vector_dim=vector_dim)
        
        # Process chunks with this dataset's FAISS manager
        process_embedding_ready_chunks(...)
```

### 4. **–£—Ç–æ—á–Ω–∏—Ç—å Step 3**

–ï—Å–ª–∏ dataset-scoped:
- –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ "FAISS Manager Management Strategy"
- –û–ø–∏—Å–∞—Ç—å, –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ FAISS managers (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç)
- –û–ø–∏—Å–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ manager –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
- –£—Ç–æ—á–Ω–∏—Ç—å, —á—Ç–æ `faiss_dir` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ `faiss_index_path`

### 5. **–£—Ç–æ—á–Ω–∏—Ç—å Step 4**

–ï—Å–ª–∏ dataset-scoped:
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞—Ç–∞—Å–µ—Ç—ã
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞:
  1. –°–æ–∑–¥–∞—Ç—å FAISS manager —Å –ø—É—Ç–µ–º: `get_faiss_index_path(faiss_dir, project_id, dataset_id)`
  2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å sync: `faiss_manager.check_index_sync(database, project_id=project_id, dataset_id=dataset_id)`
  3. –ï—Å–ª–∏ sync fails, rebuild: `faiss_manager.rebuild_from_database(..., project_id=project_id, dataset_id=dataset_id)`
  4. –ó–∞–∫—Ä—ã—Ç—å FAISS manager

### 6. **–£—Ç–æ—á–Ω–∏—Ç—å Step 5**

–ï—Å–ª–∏ dataset-scoped:
- –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –û–ø–∏—Å–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∞—Ç–æ–º–∞—Ä–Ω–æ–π –∑–∞–º–µ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–¥–µ–∫—Å —Ñ–∞–π–ª–∞
- –í–æ–∑–º–æ–∂–Ω–æ, –¥–æ–±–∞–≤–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é: –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**:
```python
# After processing all projects
for project in all_projects:
    datasets = database.get_project_datasets(project_id)
    for dataset in datasets:
        dataset_id = dataset['id']
        index_path = get_faiss_index_path(faiss_dir, project_id, dataset_id)
        faiss_manager = FaissIndexManager(index_path=index_path, vector_dim=vector_dim)
        faiss_manager.rebuild_from_database(
            database, svo_client_manager,
            project_id=project_id, dataset_id=dataset_id
        )
        faiss_manager.close()
```

### 7. **–î–æ–±–∞–≤–∏—Ç—å –≤ Edge Cases**

- **Dataset deleted while processing**: Worker should skip deleted datasets
- **Multiple datasets per project**: Worker should process all datasets sequentially
- **FAISS index path resolution**: How to determine index path for each dataset dynamically
- **Empty dataset**: Worker should handle gracefully (no files/chunks to process)

### 8. **–û–±–Ω–æ–≤–∏—Ç—å Files to Modify**

–î–æ–±–∞–≤–∏—Ç—å/—É—Ç–æ—á–Ω–∏—Ç—å:
- `code_analysis/core/worker_launcher.py` - –æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤–æ—Ä–∫–µ—Ä–∞ ‚úÖ (—É–∂–µ –µ—Å—Ç—å)
- `code_analysis/core/storage_paths.py` - –≤–æ–∑–º–æ–∂–Ω–æ, –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è project-scoped –∏–Ω–¥–µ–∫—Å–∞ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç B)
- `code_analysis/core/database/datasets.py` - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `get_project_datasets()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 9. **–û–±–Ω–æ–≤–∏—Ç—å Code Cleanup Checklist**

–î–æ–±–∞–≤–∏—Ç—å:
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –≤—ã–∑–æ–≤—ã `get_faiss_index_path()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ —É—á—Ç–µ–Ω–∞ –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ FAISS managers —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

## ‚úÖ –ß—Ç–æ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å

1. ‚úÖ –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∞
2. ‚úÖ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ (—Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è–º–∏)
3. ‚úÖ Edge cases (—Å –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏)
4. ‚úÖ Code Cleanup Checklist (—Å –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏)
5. ‚úÖ Testing scenarios
6. ‚úÖ PID file check –ª–æ–≥–∏–∫–∞
7. ‚úÖ Database auto-creation –ª–æ–≥–∏–∫–∞
8. ‚úÖ SQL –∑–∞–ø—Ä–æ—Å –≤ Step 1 (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–Ω–æ (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é):

1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é FAISS –∏–Ω–¥–µ–∫—Å–æ–≤** (dataset-scoped vs project-scoped)
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å dataset-scoped (–í–∞—Ä–∏–∞–Ω—Ç A)
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å Step 0

2. **–£—Ç–æ—á–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –≤–æ –≤—Å–µ—Ö —à–∞–≥–∞—Ö**
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –≤ Step 2, Step 4, Step 5 –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ

3. **–£—Ç–æ—á–Ω–∏—Ç—å FAISS manager management**
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –ò–∑–º–µ–Ω–∏—Ç—å Step 3 –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è manager –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

### –í–∞–∂–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è):

4. –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª–∏ SQL –∑–∞–ø—Ä–æ—Å–∞ –≤ Step 1 (—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
5. –£—Ç–æ—á–Ω–∏—Ç—å worker registration –≤ Step 6 (—É–∂–µ —É—á—Ç–µ–Ω–æ, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞)
6. –£—Ç–æ—á–Ω–∏—Ç—å FAISS index sync check –≤ Step 4 (–¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞—Ç–∞—Å–µ—Ç–æ–≤)

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] **–ö–†–ò–¢–ò–ß–ù–û**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è FAISS –∏–Ω–¥–µ–∫—Å–æ–≤ (dataset-scoped –∏–ª–∏ project-scoped)
- [ ] **–ö–†–ò–¢–ò–ß–ù–û**: –£—Ç–æ—á–Ω–µ–Ω –ø–ª–∞–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –≤–æ –≤—Å–µ—Ö —à–∞–≥–∞—Ö (Step 2, Step 4, Step 5)
- [ ] **–ö–†–ò–¢–ò–ß–ù–û**: –£—Ç–æ—á–Ω–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è FAISS manager –≤ Step 3
- [ ] **–ö–†–ò–¢–ò–ß–ù–û**: –£—Ç–æ—á–Ω–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ Step 5
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª–∏ SQL –∑–∞–ø—Ä–æ—Å–∞ –≤ Step 1 (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- [ ] –£—Ç–æ—á–Ω–µ–Ω FAISS index sync check –≤ Step 4 (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã edge cases –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω Code Cleanup Checklist

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

- **–í—Å–µ–≥–æ —à–∞–≥–æ–≤**: 11
- **–®–∞–≥–æ–≤ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏**: 6 (Step 0, Step 2, Step 3, Step 4, Step 5, Step 6)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º**: 3 (FAISS –∏–Ω–¥–µ–∫—Å—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤, FAISS manager management)
- **–í–∞–∂–Ω—ã—Ö —É—Ç–æ—á–Ω–µ–Ω–∏–π**: 3 (SQL –∑–∞–ø—Ä–æ—Å, worker registration, sync check)

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–ª–∞–Ω —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–µ—Ç–∞–ª–µ–π** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (dataset-scoped –∏–Ω–¥–µ–∫—Å—ã)

2. **–î–æ–∫—É–º–µ–Ω—Ç PLAN_AUTO_START_VECTORIZATION_WORKER_REVIEW.md** —É–∂–µ –≤—ã—è–≤–∏–ª –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ —ç—Ç–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É

3. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å dataset-scoped –∏–Ω–¥–µ–∫—Å—ã** - —ç—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø–ª–∞–Ω–µ –∏ –∫–æ–¥–µ

4. **–í—Å–µ edge cases —É—á—Ç–µ–Ω—ã**, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª—É—á–∞–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç–∞—Å–µ—Ç–∞–º–∏

5. **Testing scenarios –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ**, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
