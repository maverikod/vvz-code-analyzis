# План исправления проблемы с MCP Proxy

**Дата**: 2024-12-27  
**Автор**: Vasiliy Zdanovskiy

## Проблема

Все команды через MCP Proxy возвращают ошибку:
```
"MCP error -32602: Invalid request parameters"
```

## Метрика успеха

✅ **ВСЕ команды работают без ошибок через прокси**

## Анализ проблемы

### Симптомы

1. **MCP Proxy команды не работают**:
   - `mcp_MCP-Proxy-2_list_servers()` → "Invalid request parameters"
   - `mcp_MCP-Proxy-2_call_server()` → "Invalid request parameters"
   - `mcp_MCP-Proxy-2_help()` → "Invalid request parameters"

2. **Прямой HTTP вызов не работает**:
   - `curl https://172.28.0.1:15000/api/v1/execute` → Connection error
   - Сервер может быть не запущен или не слушает на правильном порту

3. **Прямое тестирование через Python работает**:
   - `db.search_methods(class_name='CodeDatabase')` → ✅ Работает
   - `db.search_classes(name_pattern='CodeDatabase')` → ✅ Работает

### Возможные причины

1. **Сервер не запущен или не слушает**
2. **Неправильный формат вызова MCP Proxy команд**
3. **Проблема в конфигурации MCP Proxy**
4. **Проблема в регистрации сервера в MCP Proxy**

## План действий

### Этап 1: Проверка статуса сервера

1. ✅ Проверить, запущен ли сервер
2. ✅ Проверить, на каком порту слушает
3. ✅ Проверить логи сервера
4. ✅ Проверить конфигурацию

### Этап 2: Исправление проблемы

1. **Если сервер не запущен**:
   - Запустить сервер
   - Проверить регистрацию в MCP Proxy
   - Проверить логи

2. **Если проблема в формате вызова**:
   - Проверить документацию MCP Proxy
   - Исправить формат вызова
   - Протестировать

3. **Если проблема в MCP Proxy**:
   - Проверить конфигурацию MCP Proxy
   - Проверить регистрацию сервера
   - Перезапустить MCP Proxy

### Этап 3: Тестирование

1. Протестировать базовые команды:
   - `health`
   - `help`
   - `list_servers`

2. Протестировать исправленные команды:
   - `search_ast_nodes`
   - `list_class_methods`

3. Протестировать все остальные команды:
   - `get_database_status`
   - `list_code_entities`
   - `find_classes`
   - `get_imports`
   - И т.д.

### Этап 4: Валидация

1. ✅ Все команды работают через MCP Proxy
2. ✅ Нет ошибок "Invalid request parameters"
3. ✅ Результаты корректны

## Текущий статус

- ⏳ Этап 1: В процессе
- ⏳ Этап 2: Ожидает
- ⏳ Этап 3: Ожидает
- ⏳ Этап 4: Ожидает

## Следующие шаги

1. Проверить статус сервера
2. Исправить проблему
3. Протестировать все команды
4. Убедиться, что все работают через MCP Proxy

