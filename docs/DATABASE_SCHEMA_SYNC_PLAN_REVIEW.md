# Database Schema Sync Implementation Plan - Review

**Author**: Vasiliy Zdanovskiy  
**email**: vasilyvz@gmail.com  
**Date**: 2026-01-10

## Overall Assessment

–ü–ª–∞–Ω –≤ —Ü–µ–ª–æ–º **–ø–æ–ª–Ω—ã–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π**, –Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–µ—è—Å–Ω–æ—Å—Ç–µ–π** –∏ **–ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π.

## ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. **–•–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
2. **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω**: –ü–æ—à–∞–≥–æ–≤—ã–µ —Ñ–∞–∑—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞
3. **–£—á—Ç–µ–Ω—ã edge cases**: –ü—É—Å—Ç–∞—è –ë–î, –æ—à–∏–±–∫–∏ –±—ç–∫–∞–ø–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ë—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è, rollback
5. **Worker flow**: –ü–æ–Ω—è—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω lazy initialization –¥–ª—è DB worker

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –Ω–µ—è—Å–Ω–æ—Å—Ç–∏

### 1. Phase 1: –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ –≤ `_create_schema()`

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –°—Ç—Ä–æ–∫–∞ 167: "Remove `_create_schema()` call from `__init__`" 
- –°—Ç—Ä–æ–∫–∞ 200: "This method defines the schema but does NOT execute it"
- –°—Ç—Ä–æ–∫–∏ 206-214: –ú–µ—Ç–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç `self._execute(...)` - **–≤—ã–ø–æ–ª–Ω—è–µ—Ç SQL**

**–†–µ—à–µ–Ω–∏–µ**: 
–ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å, —á—Ç–æ `_create_schema()` –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ç—å **–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π** (–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ö–µ–º—ã), –∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL. –ò–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `_define_schema()` –∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**:
```python
def _define_schema(self) -> Dict[str, Any]:
    """
    Define database schema structure (declarative, no SQL execution).
    
    Returns:
        Schema definition dictionary for SchemaComparator
    """
    # Return structured schema definition, not SQL
    return {
        "tables": {...},
        "indexes": [...],
        ...
    }
```

### 2. Phase 1: `get_schema_definition()` –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –°—Ç—Ä–æ–∫–∞ 277: –¢–æ–ª—å–∫–æ `pass`, –Ω–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ú–µ—Ç–æ–¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Phase 6 –∏ Phase 7

**–†–µ—à–µ–Ω–∏–µ**: 
–ù—É–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å, –∫–∞–∫ –∏–∑–≤–ª–µ–∫–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –∏–∑ `_create_schema()`:
- –ü–∞—Ä—Å–∏—Ç—å SQL? (—Å–ª–æ–∂–Ω–æ –∏ –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è? (–ª—É—á—à–µ)
- –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –¥–≤—É—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö? (SQL + —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç SQL, –∏–ª–∏ –ø–∞—Ä—Å–∏—Ç—å SQL –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ.

### 3. Phase 6 vs Phase 7: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã `sync_schema()`

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Phase 6, —Å—Ç—Ä–æ–∫–∞ 1057: `sync_schema(self, database: CodeDatabase)`
- Phase 7, —Å—Ç—Ä–æ–∫–∞ 1268: `self.driver.sync_schema(self, schema_definition)`

**–†–µ—à–µ–Ω–∏–µ**: 
–£—Ç–æ—á–Ω–∏—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—É:
- –í–∞—Ä–∏–∞–Ω—Ç A: `sync_schema(database: CodeDatabase)` - proxy –ø–æ–ª—É—á–∞–µ—Ç CodeDatabase, —Å–∞–º –∏–∑–≤–ª–µ–∫–∞–µ—Ç schema_definition
- –í–∞—Ä–∏–∞–Ω—Ç B: `sync_schema(schema_definition: Dict[str, Any])` - CodeDatabase –ø–µ—Ä–µ–¥–∞–µ—Ç –≥–æ—Ç–æ–≤–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—Ä–∏–∞–Ω—Ç B (–∫–∞–∫ –≤ Phase 7) - –±–æ–ª–µ–µ —è–≤–Ω—ã–π –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∏ CodeDatabase –≤ driver.

### 4. Phase 2: BackupManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Phase 2, —Å—Ç—Ä–æ–∫–∞ 373: `create_database_backup(db_path, backup_dir, ...)`
- Phase 4, —Å—Ç—Ä–æ–∫–∞ 863: `BackupManager(project_root)` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å project_root
- BackupManager.__init__ (—Ç–µ–∫—É—â–∏–π –∫–æ–¥): –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `root_dir`, —Å–æ–∑–¥–∞–µ—Ç `self.backup_dir = root_dir / "old_code"`

**–†–µ—à–µ–Ω–∏–µ**: 
–£—Ç–æ—á–Ω–∏—Ç—å:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `old_code` –∏–ª–∏ –Ω–æ–≤—ã–π `backups`?
- –ö–∞–∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å `backup_dir` –∏–∑ StoragePaths —Å `old_code` –≤ BackupManager?

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
–õ–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `backup_dir` –≤ `create_database_backup()` (–∫–∞–∫ –≤ –ø–ª–∞–Ω–µ), –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ë–î –±—ç–∫–∞–ø–æ–≤.

### 5. Phase 4: –ü–æ–ª—É—á–µ–Ω–∏–µ backup_dir

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Phase 4, —Å—Ç—Ä–æ–∫–∏ 858-861: –õ–æ–≥–∏–∫–∞ –≤—ã–≤–æ–¥–∞ `backup_dir` –∏–∑ `db_path`
- Phase 2: `backup_dir` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ StoragePaths
- Phase 6: –¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ –≤—ã–≤–æ–¥–∞ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–†–µ—à–µ–Ω–∏–µ**: 
–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `backup_dir` –∏–∑ StoragePaths —á–µ—Ä–µ–∑ config –∏–ª–∏ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä, –∞ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
–í Phase 4 –ø–æ–ª—É—á–∞—Ç—å `backup_dir` –∏–∑ `StoragePaths` (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ config –∏–ª–∏ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ `sync_schema()`).

### 6. Phase 1: `_get_schema_version()` –∏ `_set_schema_version()` –≤ CodeDatabase

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Phase 1: –ú–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ CodeDatabase
- Phase 4: –¢–µ –∂–µ –º–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ SQLiteDriver
- –ö—Ç–æ –¥–æ–ª–∂–µ–Ω —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–µ—Ä—Å–∏–µ–π? CodeDatabase –∏–ª–∏ Driver?

**–†–µ—à–µ–Ω–∏–µ**: 
–£—Ç–æ—á–Ω–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
- –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î, –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ Driver (–∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ë–î)
- CodeDatabase –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–±–µ—Ä—Ç–∫—É, –Ω–æ –ª–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ Driver

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
–ú–µ—Ç–æ–¥—ã –≤–µ—Ä—Å–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ Driver (SQLiteDriver), CodeDatabase –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–±–µ—Ä—Ç–∫—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.

### 7. Phase 3: SchemaComparator - –Ω–µ–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**: 
–ú–Ω–æ–≥–∏–µ –º–µ—Ç–æ–¥—ã –≤ SchemaComparator –∏–º–µ—é—Ç —Ç–æ–ª—å–∫–æ `pass`:
- `_get_current_virtual_tables()` (—Å—Ç—Ä–æ–∫–∞ 612)
- `_compare_table()` (—Å—Ç—Ä–æ–∫–∞ 631)
- `_compare_indexes()` (—Å—Ç—Ä–æ–∫–∞ 637)
- `_compare_constraints()` (—Å—Ç—Ä–æ–∫–∞ 643)

**–†–µ—à–µ–Ω–∏–µ**: 
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–ª–∞–Ω–∞, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –º–µ—Ç–æ–¥—ã –±—É–¥—É—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ Phase 3.

### 8. Phase 7: CodeDatabase.sync_schema() —Å–∏–≥–Ω–∞—Ç—É—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Phase 7, —Å—Ç—Ä–æ–∫–∞ 1265: `def sync_schema(self) -> Dict[str, Any]:`
- Phase 7, —Å—Ç—Ä–æ–∫–∞ 1268: `return self.driver.sync_schema(self, schema_definition)`
- –ù–æ –≤ Phase 6 proxy –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `database: CodeDatabase`, –∞ –≤ Phase 7 –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `self` –∏ `schema_definition`

**–†–µ—à–µ–Ω–∏–µ**: 
–£—Ç–æ—á–Ω–∏—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—É proxy:
```python
# –í SQLiteDriverProxy
def sync_schema(self, schema_definition: Dict[str, Any], backup_dir: Path) -> Dict[str, Any]:
    # ...
```

### 9. Migration Methods Registry

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- Phase 1: `MIGRATION_METHODS` –≤ CodeDatabase
- Phase 4: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `from ..database.base import MIGRATION_METHODS`
- –ù–æ –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Å `driver` (SQLiteDriver), –∞ –Ω–µ —Å CodeDatabase

**–†–µ—à–µ–Ω–∏–µ**: 
–£—Ç–æ—á–Ω–∏—Ç—å, –≥–¥–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å registry:
- –ï—Å–ª–∏ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å driver, registry –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ driver
- –ò–ª–∏ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å driver, –∞ registry –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ base.py

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
Registry –≤ `base.py` (CodeDatabase), –º–µ—Ç–æ–¥—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç driver instance.

### 10. Virtual Tables (FTS5) - –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- Phase 3, —Å—Ç—Ä–æ–∫–∞ 687: `CREATE TEMP TABLE temp_{table_name} AS SELECT * FROM {table_name}`
- –ù–æ FTS5 —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, SELECT * –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**: 
–ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ FTS5 —Ç–∞–±–ª–∏—Ü. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–µ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `INSERT INTO ... SELECT ...` —Å —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–æ–Ω–æ–∫, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å content table –µ—Å–ª–∏ FTS5 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç external content.

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
–ü–æ–∫–∞–∑–∞—Ç—å flow –æ—Ç `CodeDatabase.__init__()` –¥–æ `SQLiteDriver.sync_schema()`.

### 2. –£—Ç–æ—á–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç schema_definition
–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞.

### 3. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "Rollback Strategy"
–î–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—Å–∞—Ç—å, –∫–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

### 4. –£—Ç–æ—á–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞?
- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –±—ç–∫–∞–ø –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è?
- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —É–ø–∞–ª–∞ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ?

### 5. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å –≤–µ—Ä—Å–∏–∏ 1.0.0 –Ω–∞ 1.1.0
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–æ–ª–æ–Ω–∫–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã

## ‚úÖ –ß—Ç–æ —É—á—Ç–µ–Ω–æ —Ö–æ—Ä–æ—à–æ

1. ‚úÖ Worker lazy initialization
2. ‚úÖ Backup –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
3. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
4. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–π –ë–î
5. ‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (FTS5)
6. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã
7. ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã
8. ‚úÖ Transaction rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–ü–æ–ª–Ω–æ—Ç–∞**: 8/10 (–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Ç–æ–¥–æ–≤)  
**–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å**: 7/10 (–µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞—Ö)  
**–†–µ–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å**: 8/10 (–ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π)

**–í—ã–≤–æ–¥**: –ü–ª–∞–Ω —Ö–æ—Ä–æ—à–∏–π, –Ω–æ –Ω—É–∂–Ω–æ **—É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è** –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –æ—Å–æ–±–µ–Ω–Ω–æ:
1. –°–∏–≥–Ω–∞—Ç—É—Ä—ã –º–µ—Ç–æ–¥–æ–≤ `sync_schema()`
2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—é `get_schema_definition()`
3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–µ–π —Å—Ö–µ–º—ã (CodeDatabase vs Driver)
4. –§–æ—Ä–º–∞—Ç –∏ –º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è `MIGRATION_METHODS`
