# План тестирования команд по группам

Author: Vasiliy Zdanovskiy  
email: vasilyvz@gmail.com

## Общая информация

- **Тестовые данные**: `test_data/bhlff` (копируется в `test_data/test_commands_<timestamp>` для каждого прогона)
- **Метод тестирования**: Через MCP Proxy (`mcp_MCP-Proxy-2_call_server`)
- **Порядок**: По группам команд

## Группы команд для тестирования

### 1. REFACTOR (6 команд)

#### 1.1 `list_cst_blocks`
- **Цель**: Получить список блоков из тестового файла
- **Параметры**: `root_dir`, `file_path`
- **Ожидаемый результат**: Список блоков с id, kind, qualname, line ranges

#### 1.2 `query_cst`
- **Цель**: Найти узлы по CSTQuery селектору
- **Параметры**: `root_dir`, `file_path`, `selector`
- **Ожидаемый результат**: Список совпадений с node_id

#### 1.3 `compose_cst_module` - Replace
- **Цель**: Заменить блок кода
- **Параметры**: `root_dir`, `file_path`, `ops` (operation_type="replace")
- **Ожидаемый результат**: Успешная замена, diff, compiled=true

#### 1.4 `compose_cst_module` - Insert
- **Цель**: Вставить новый узел
- **Параметры**: `root_dir`, `file_path`, `ops` (operation_type="insert")
- **Ожидаемый результат**: Успешная вставка, diff, compiled=true

#### 1.5 `compose_cst_module` - Create
- **Цель**: Создать новый узел
- **Параметры**: `root_dir`, `file_path`, `ops` (operation_type="create")
- **Ожидаемый результат**: Успешное создание, diff, compiled=true

#### 1.6 `split_class`
- **Цель**: Разделить класс на несколько классов
- **Параметры**: `root_dir`, `file_path`, `class_name`, `config_path`
- **Ожидаемый результат**: Preview или успешное разделение

#### 1.7 `extract_superclass`
- **Цель**: Извлечь базовый класс
- **Параметры**: `root_dir`, `file_path`, `class_name`, `config_path`
- **Ожидаемый результат**: Preview или успешное извлечение

#### 1.8 `split_file_to_package`
- **Цель**: Разделить файл на пакет
- **Параметры**: `root_dir`, `file_path`, `config_path`
- **Ожидаемый результат**: Preview или успешное разделение

---

### 2. ANALYSIS (16 команд)

#### 2.1 `update_indexes`
- **Цель**: Обновить индексы code_mapper
- **Параметры**: `root_dir`, `max_lines` (default: 400)
- **Ожидаемый результат**: Успешное обновление индексов

#### 2.2 `list_long_files`
- **Цель**: Получить список длинных файлов
- **Параметры**: `root_dir`, `max_lines` (default: 400)
- **Ожидаемый результат**: Список файлов с lines > max_lines

#### 2.3 `list_errors_by_category`
- **Цель**: Получить ошибки по категориям
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Словарь категорий с ошибками, summary, total

#### 2.4 `get_code_entity_info`
- **Цель**: Получить информацию о сущности
- **Параметры**: `root_dir`, `entity_type`, `entity_name`
- **Ожидаемый результат**: Детальная информация о сущности

#### 2.5 `list_code_entities`
- **Цель**: Список сущностей по типу
- **Параметры**: `root_dir`, `entity_type`
- **Ожидаемый результат**: Список сущностей

#### 2.6 `get_ast`
- **Цель**: Получить AST файла
- **Параметры**: `root_dir`, `file_path`
- **Ожидаемый результат**: AST в JSON формате

#### 2.7 `search_ast_nodes`
- **Цель**: Поиск узлов AST по типу
- **Параметры**: `root_dir`, `node_type`
- **Ожидаемый результат**: Список найденных узлов

#### 2.8 `ast_statistics`
- **Цель**: Статистика AST проекта
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Статистика по узлам AST

#### 2.9 `list_project_files`
- **Цель**: Список файлов проекта
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Список файлов проекта

#### 2.10 `get_imports`
- **Цель**: Получить импорты проекта
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Список импортов

#### 2.11 `find_dependencies`
- **Цель**: Найти зависимости между файлами
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Граф зависимостей

#### 2.12 `get_class_hierarchy`
- **Цель**: Получить иерархию классов
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Иерархия классов

#### 2.13 `find_usages`
- **Цель**: Найти использования сущности
- **Параметры**: `root_dir`, `name`
- **Ожидаемый результат**: Список использований

#### 2.14 `export_graph`
- **Цель**: Экспортировать граф зависимостей
- **Параметры**: `root_dir`, `output`
- **Ожидаемый результат**: Файл с графом

#### 2.15 `analyze_project`
- **Цель**: Анализ всего проекта
- **Параметры**: `root_dir`, `max_lines`
- **Ожидаемый результат**: Результаты анализа

#### 2.16 `analyze_file`
- **Цель**: Анализ одного файла
- **Параметры**: `root_dir`, `file_path`
- **Ожидаемый результат**: Результаты анализа файла

---

### 3. SEARCH (4 команды)

#### 3.1 `fulltext_search`
- **Цель**: Полнотекстовый поиск
- **Параметры**: `root_dir`, `query`, `limit`
- **Ожидаемый результат**: Список совпадений

#### 3.2 `list_class_methods`
- **Цель**: Список методов класса
- **Параметры**: `root_dir`, `class_name`
- **Ожидаемый результат**: Список методов класса

#### 3.3 `find_classes`
- **Цель**: Найти классы по паттерну
- **Параметры**: `root_dir`, `pattern`
- **Ожидаемый результат**: Список найденных классов

#### 3.4 `semantic_search`
- **Цель**: Семантический поиск
- **Параметры**: `root_dir`, `query`, `k`
- **Ожидаемый результат**: Список семантически похожих фрагментов

---

### 4. CODE_QUALITY (3 команды)

#### 4.1 `format_code`
- **Цель**: Форматирование кода
- **Параметры**: `file_path`
- **Ожидаемый результат**: Отформатированный код или ошибка

#### 4.2 `lint_code`
- **Цель**: Линтинг кода
- **Параметры**: `file_path`
- **Ожидаемый результат**: Список ошибок линтера или успех

#### 4.3 `type_check_code`
- **Цель**: Проверка типов
- **Параметры**: `file_path`, `ignore_errors`
- **Ожидаемый результат**: Список ошибок типов или успех

---

### 5. FILE_MANAGEMENT (4 команды)

#### 5.1 `cleanup_deleted_files`
- **Цель**: Очистка удаленных файлов
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Статистика очистки

#### 5.2 `unmark_deleted_file`
- **Цель**: Снять пометку удаления
- **Параметры**: `root_dir`, `file_path`
- **Ожидаемый результат**: Успешное снятие пометки

#### 5.3 `collapse_versions`
- **Цель**: Свернуть версии файла
- **Параметры**: `root_dir`, `file_path`
- **Ожидаемый результат**: Успешное свертывание

#### 5.4 `repair_database`
- **Цель**: Восстановление базы данных
- **Параметры**: `root_dir`, `dry_run`
- **Ожидаемый результат**: Статистика восстановления

---

### 6. BACKUP (5 команд)

#### 6.1 `list_backup_files`
- **Цель**: Список файлов бэкапов
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Список файлов бэкапов

#### 6.2 `list_backup_versions`
- **Цель**: Список версий бэкапа
- **Параметры**: `root_dir`, `file_path`
- **Ожидаемый результат**: Список версий

#### 6.3 `restore_backup_file`
- **Цель**: Восстановить файл из бэкапа
- **Параметры**: `root_dir`, `file_path`, `version_id`
- **Ожидаемый результат**: Успешное восстановление

#### 6.4 `delete_backup`
- **Цель**: Удалить бэкап
- **Параметры**: `root_dir`, `file_path`, `version_id`
- **Ожидаемый результат**: Успешное удаление

#### 6.5 `clear_all_backups`
- **Цель**: Очистить все бэкапы
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Успешная очистка

---

### 7. LOGGING (2 команды)

#### 7.1 `view_worker_logs`
- **Цель**: Просмотр логов воркера
- **Параметры**: `log_path`, `tail`, `limit`
- **Ожидаемый результат**: Логи воркера

#### 7.2 `list_worker_logs`
- **Цель**: Список лог-файлов
- **Параметры**: `log_dirs`, `worker_type`
- **Ожидаемый результат**: Список лог-файлов

---

### 8. MONITORING (2 команды)

#### 8.1 `get_worker_status`
- **Цель**: Статус воркеров
- **Параметры**: `worker_type`
- **Ожидаемый результат**: Статус воркеров

#### 8.2 `get_database_status`
- **Цель**: Статус базы данных
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Статистика базы данных

---

### 9. REPAIR_WORKER (3 команды)

#### 9.1 `start_repair_worker`
- **Цель**: Запустить repair worker
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Успешный запуск

#### 9.2 `stop_repair_worker`
- **Цель**: Остановить repair worker
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Успешная остановка

#### 9.3 `repair_worker_status`
- **Цель**: Статус repair worker
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Статус воркера

---

### 10. VECTORIZATION (3 команды)

#### 10.1 `rebuild_faiss`
- **Цель**: Пересобрать FAISS индекс
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Успешная пересборка

#### 10.2 `revectorize`
- **Цель**: Перевекторизовать чанки
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Успешная перевекторизация

#### 10.3 `check_vectors`
- **Цель**: Проверить статус векторизации
- **Параметры**: `root_dir`
- **Ожидаемый результат**: Статус векторизации

---

### 11. OTHER (2 команды)

#### 11.1 `help`
- **Цель**: Справка по командам
- **Параметры**: `command` (optional)
- **Ожидаемый результат**: Справка

#### 11.2 `health`
- **Цель**: Проверка здоровья сервера
- **Параметры**: нет
- **Ожидаемый результат**: Статус сервера

---

## Порядок выполнения

1. Подготовка тестовых данных
2. Тестирование группы REFACTOR
3. Тестирование группы ANALYSIS
4. Тестирование группы SEARCH
5. Тестирование группы CODE_QUALITY
6. Тестирование группы FILE_MANAGEMENT
7. Тестирование группы BACKUP
8. Тестирование группы LOGGING
9. Тестирование группы MONITORING
10. Тестирование группы REPAIR_WORKER
11. Тестирование группы VECTORIZATION
12. Тестирование группы OTHER

## Критерии успеха

- ✅ Команда выполняется без ошибок
- ✅ Возвращает ожидаемый результат
- ✅ Результат соответствует схеме команды
- ✅ Для команд с apply=true - изменения применены корректно

## Отчет о тестировании

После каждого теста записывать:
- ✅ Успех / ❌ Ошибка
- Время выполнения
- Результат (краткое описание)
- Ошибки (если есть)

